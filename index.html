<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>üö® SKIBIDI_FLASHBANG_MAX_VOL üö®</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* --- GLOBAL CHAOS --- */
        body {
            margin: 0;
            background-color: #000;
            color: #0f0;
            font-family: 'Courier New', monospace;
            overflow: hidden;
            cursor: crosshair;
        }

        /* BACKGROUND IMAGE TILES (Pizza/Toilet) */
        .bg-tiled {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: 
                url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="60" height="60"><text y="40" font-size="40">üçï</text></svg>'),
                url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="60" height="60"><text y="40" font-size="40">üöΩ</text></svg>');
            background-position: 0 0, 30px 30px;
            opacity: 0.2;
            z-index: -1;
            animation: scroll-bg 1s linear infinite;
        }
        @keyframes scroll-bg {
            0% { background-position: 0 0, 30px 30px; }
            100% { background-position: 60px 60px, 90px 90px; }
        }

        /* --- THE FLASHBANG OVERLAY --- */
        #flash-layer {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: white;
            opacity: 0;
            pointer-events: none;
            z-index: 9999;
        }
        .blinded { animation: flash-blind 4s ease-out forwards; }
        
        @keyframes flash-blind {
            0% { opacity: 1; background: white; }
            10% { opacity: 1; background: white; }
            100% { opacity: 0; }
        }

        /* --- GRENADE SVG ANIMATION --- */
        #grenade {
            position: fixed; bottom: -100px; right: -100px;
            width: 100px;
            z-index: 5000;
            display: none;
        }
        .throw-grenade {
            display: block !important;
            animation: toss 1.5s ease-out forwards;
        }
        @keyframes toss {
            0% { bottom: -100px; right: -100px; transform: rotate(0deg); }
            50% { bottom: 50%; right: 50%; transform: rotate(-360deg) scale(2); }
            100% { bottom: 50%; right: 50%; transform: rotate(-720deg) scale(2); }
        }

        /* --- CRAZY BUTTONS --- */
        .insane-btn {
            background: red;
            color: yellow;
            border: 5px solid lime;
            font-size: 2rem;
            padding: 20px 40px;
            font-weight: 900;
            text-transform: uppercase;
            cursor: pointer;
            position: relative;
            box-shadow: 10px 10px 0 blue;
            transition: 0.05s;
            animation: wiggle 0.5s infinite;
        }
        .insane-btn:hover {
            animation: seizure 0.1s infinite;
            background: blue;
            color: white;
            transform: scale(1.2) rotate(5deg);
            border-color: magenta;
            box-shadow: -10px -10px 0 yellow;
        }

        @keyframes wiggle { 0% {transform: rotate(1deg);} 50% {transform: rotate(-1deg);} 100% {transform: rotate(1deg);} }
        @keyframes seizure {
            0% { transform: translate(2px, 2px) rotate(0deg); filter: hue-rotate(0deg); }
            25% { transform: translate(-2px, -2px) rotate(-5deg); filter: hue-rotate(90deg); }
            50% { transform: translate(2px, -2px) rotate(5deg); filter: hue-rotate(180deg); }
            75% { transform: translate(-2px, 2px) rotate(-5deg); filter: hue-rotate(270deg); }
            100% { transform: translate(2px, 2px) rotate(0deg); filter: hue-rotate(360deg); }
        }

        /* --- UI LAYOUT --- */
        .screen {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100vh; width: 100vw; text-align: center;
            position: absolute; top: 0; left: 0;
            background: rgba(0,0,0,0.8);
        }
        .hidden { display: none !important; }

        h1 {
            font-size: 4rem;
            text-shadow: 4px 4px 0 #ff0000;
            animation: glitch-text 0.2s infinite;
        }
        @keyframes glitch-text {
            0% { text-shadow: 4px 4px 0 red; transform: translate(0,0); }
            20% { text-shadow: -4px 4px 0 blue; transform: translate(2px,2px); }
            40% { text-shadow: -4px -4px 0 lime; transform: translate(-2px,2px); }
            60% { text-shadow: 4px -4px 0 yellow; transform: translate(2px,-2px); }
            80% { text-shadow: 4px 0px 0 magenta; transform: translate(-2px,-2px); }
        }

        /* CANVAS */
        canvas { border: 5px solid white; box-shadow: 0 0 50px red; background: #111; }

    </style>
</head>
<body>

    <div class="bg-tiled"></div>
    <div id="flash-layer"></div>
    
    <svg id="grenade" viewBox="0 0 100 200" xmlns="http://www.w3.org/2000/svg">
        <rect x="30" y="50" width="40" height="100" rx="5" fill="#444" stroke="black" stroke-width="2"/>
        <rect x="25" y="40" width="50" height="10" fill="#ccc" stroke="black"/>
        <rect x="40" y="20" width="10" height="30" fill="#ccc" stroke="black"/> <circle cx="70" cy="45" r="8" fill="none" stroke="silver" stroke-width="2"/> <text x="35" y="100" fill="white" font-weight="bold" font-family="Arial">M84</text>
        <path d="M 30 70 L 70 70" stroke="black"/>
        <path d="M 30 90 L 70 90" stroke="black"/>
    </svg>

    <div id="step-init" class="screen">
        <h1 style="color:red;">‚ö†Ô∏è WARNING ‚ö†Ô∏è</h1>
        <h2>LOUD SOUNDS & FLASHING LIGHTS</h2>
        <br>
        <button class="insane-btn" onclick="initSystem()">INITIALIZE CHAOS</button>
    </div>

    <div id="step-game" class="screen hidden">
        <h1>DODGE THE SPIKES</h1>
        <canvas id="gameCanvas" width="600" height="300"></canvas>
        <h2 id="score">SCORE: 0</h2>
    </div>

    <div id="step-quiz" class="screen hidden">
        <h1>THE BRAINROT TEST</h1>
        <h2 id="qText">...</h2>
        <div id="qOptions"></div>
    </div>

    <div id="step-end" class="screen hidden">
        <h1 style="font-size: 6rem;">GOON CAVE UNLOCKED</h1>
        <div style="font-size: 3rem; font-weight: bold; line-height: 1.5; text-transform: uppercase; color: white;">
            <div class="insane-btn" style="background:transparent; border:none; box-shadow:none;">üçï EAT PIZZA</div>
            <div class="insane-btn" style="background:transparent; border:none; box-shadow:none;">üò¥ SLEEP</div>
            <div class="insane-btn" style="background:transparent; border:none; box-shadow:none; color:red; font-size:5rem;">üëπ GOON</div>
            <div class="insane-btn" style="background:transparent; border:none; box-shadow:none;">üîÅ REPEAT</div>
        </div>
        <br>
        <button class="insane-btn" onclick="location.reload()">PRESTIGE</button>
    </div>

    <script>
        // --- AUDIO ENGINE (RAW SYNTHESIS) ---
        let audioCtx;
        
        function initAudio() {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            audioCtx = new AudioContext();
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
        }

        // GENERATE FLASHBANG SOUND (White Noise + Sine Wave)
        function playFlashSound() {
            const t = audioCtx.currentTime;
            
            // 1. EXPLOSION (White Noise)
            const bufferSize = audioCtx.sampleRate * 2; // 2 seconds
            const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const data = buffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) {
                data[i] = Math.random() * 2 - 1;
            }
            const noise = audioCtx.createBufferSource();
            noise.buffer = buffer;
            
            const noiseGain = audioCtx.createGain();
            noiseGain.gain.setValueAtTime(1, t);
            noiseGain.gain.exponentialRampToValueAtTime(0.01, t + 1);
            
            noise.connect(noiseGain);
            noiseGain.connect(audioCtx.destination);
            noise.start();

            // 2. TINNITUS (High Pitch Ring)
            const osc = audioCtx.createOscillator();
            osc.type = 'sine';
            osc.frequency.setValueAtTime(3000, t); // 3000Hz Ring
            
            const oscGain = audioCtx.createGain();
            oscGain.gain.setValueAtTime(0.1, t);
            oscGain.gain.linearRampToValueAtTime(0.2, t + 0.1);
            oscGain.gain.exponentialRampToValueAtTime(0.001, t + 5); // Rings for 5 seconds

            osc.connect(oscGain);
            oscGain.connect(audioCtx.destination);
            osc.start();
            osc.stop(t + 5);
        }

        // GENERATE BUTTON/JUMP SOUNDS
        function playBeep(freq = 400, type = 'square') {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.1);
        }

        // --- FLASHBANG VISUAL LOGIC ---
        function triggerFlashbang(callback) {
            const nade = document.getElementById('grenade');
            const flash = document.getElementById('flash-layer');
            
            // 1. Throw Grenade
            nade.classList.add('throw-grenade');
            
            // 2. Wait for impact
            setTimeout(() => {
                nade.style.display = 'none'; // Hide grenade
                flash.classList.add('blinded'); // White screen
                playFlashSound(); // BOOM + RING
                
                // 3. Recover
                setTimeout(() => {
                    flash.classList.remove('blinded');
                    nade.classList.remove('throw-grenade');
                    nade.style.display = ''; // Reset
                    if (callback) callback();
                }, 4000); // 4 seconds of blindness
            }, 1500); // 1.5s throw animation
        }

        // --- GAME SYSTEM ---
        function initSystem() {
            initAudio(); // START SOUND
            playBeep(600);
            document.getElementById('step-init').classList.add('hidden');
            document.getElementById('step-game').classList.remove('hidden');
            startGame();
        }

        // Add Hover Sounds to all buttons dynamically
        document.querySelectorAll('button').forEach(b => {
            b.onmouseenter = () => {
                if(audioCtx) playBeep(200, 'sawtooth'); // Bzzt sound
            };
        });

        // CANVAS GAME
        let canvas, ctx, gameLoop;
        let player = { y: 200, dy: 0, grounded: false };
        let obstacles = [];
        let score = 0;
        let gameActive = false;

        function startGame() {
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');
            gameActive = true;
            document.body.onkeydown = (e) => { if(e.code==='Space') jump(); };
            document.body.onclick = jump;
            loop();
        }

        function jump() {
            if(player.grounded) {
                player.dy = -15; 
                player.grounded = false;
                playBeep(600, 'square');
            }
        }

        function loop() {
            if(!gameActive) return;
            requestAnimationFrame(loop);
            ctx.clearRect(0,0,600,300);

            // Physics
            player.dy += 1;
            player.y += player.dy;
            if(player.y > 250) { player.y = 250; player.grounded = true; player.dy=0; }

            // Draw Player (Blue Cube)
            ctx.fillStyle = '#00f'; ctx.fillRect(50, player.y, 40, 40);
            ctx.strokeStyle = '#fff'; ctx.strokeRect(50, player.y, 40, 40);

            // Obstacles
            if(Math.random() < 0.02) obstacles.push({x:600, w:30, h:50});
            
            obstacles.forEach(o => {
                o.x -= 8;
                ctx.fillStyle = 'red';
                ctx.beginPath();
                ctx.moveTo(o.x, 290); ctx.lineTo(o.x+15, 240); ctx.lineTo(o.x+30, 290);
                ctx.fill();

                // HIT DETECTION
                if(o.x < 90 && o.x > 20 && player.y > 210) {
                    gameActive = false;
                    // FLASHBANG PUNISHMENT
                    triggerFlashbang(() => {
                        // Restart Game
                        obstacles = []; score = 0; gameActive = true; loop();
                    });
                }
            });
            obstacles = obstacles.filter(o => o.x > -50);

            score++;
            ctx.fillStyle = 'white'; ctx.font = '20px Courier New';
            ctx.fillText("SCORE: " + score, 10, 30);

            if(score > 500) {
                gameActive = false;
                startQuiz();
            }
        }

        // --- QUIZ ---
        function startQuiz() {
            document.getElementById('step-game').classList.add('hidden');
            document.getElementById('step-quiz').classList.remove('hidden');
            document.body.onclick = null; // Remove game jump listener
            loadQuestion();
        }

        function loadQuestion() {
            const q = { t: "COMPLETE: SKIBIDI ____", o: ["TOILET", "RIZZ", "OHIO"], a: 0 };
            document.getElementById('qText').innerText = q.t;
            const div = document.getElementById('qOptions');
            div.innerHTML = "";
            q.o.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = "insane-btn";
                btn.style.margin = "10px";
                btn.innerText = opt;
                btn.onclick = () => {
                    if(i === q.a) {
                        playBeep(800);
                        endGame();
                    } else {
                        triggerFlashbang(); // WRONG ANSWER = FLASHBANG
                    }
                };
                div.appendChild(btn);
            });
        }

        function endGame() {
            document.getElementById('step-quiz').classList.add('hidden');
            document.getElementById('step-end').classList.remove('hidden');
            // Infinite loop of beeps and color changes
            setInterval(() => {
                document.body.style.filter = `hue-rotate(${Math.random()*360}deg)`;
                playBeep(Math.random()*1000, 'sawtooth');
            }, 200);
        }

    </script>
</body>
</html>
